{"version":3,"file":"cm-dialog.js","sourceRoot":"","sources":["../../../src/components/cm-dialog/cm-dialog.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, EventEmitter, Host, Listen, State, h, Event, Method, Fragment, Element, Prop } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'cm-dialog',\r\n  styleUrl: 'cm-dialog.css',\r\n  shadow: true,\r\n})\r\nexport class CmDialog {\r\n  @State() isDialogVisible: boolean = false;\r\n  @Prop({ reflect: true }) isAlertDialog: boolean = false;\r\n  @Prop({ reflect: true }) dialogTitle: string = 'Dialog Title';\r\n  @Element() el: HTMLElement;\r\n  @Event() openDialog: EventEmitter<null>;\r\n  @Event() closeDialog: EventEmitter<null>;\r\n\r\n  private firstFocusableEl: HTMLElement;\r\n  private lastFocusableEl: HTMLElement;\r\n  private allFocusableEls: HTMLElement[];\r\n  @Listen('openDialog', { target: 'body' })\r\n  handleOpenDialog() {\r\n    this.toggleOpen();\r\n  }\r\n\r\n  @Listen('closeDialog', { target: 'body' })\r\n  handleCloseDialog() {\r\n    this.toggleClose();\r\n  }\r\n\r\n  @Method()\r\n  async toggleOpen() {\r\n    this.isDialogVisible = true;\r\n    document.body.style.pointerEvents = 'none';\r\n    document.body.style.overflow = 'hidden';\r\n    setTimeout(() => {\r\n      this.updateFocusableElements();\r\n\r\n      this.firstFocusableEl?.focus();\r\n    }, 150);\r\n  }\r\n\r\n  @Method()\r\n  async toggleClose() {\r\n    this.isDialogVisible = false;\r\n    document.body.style.pointerEvents = 'all';\r\n    document.body.style.overflow = 'auto';\r\n    this.el.removeEventListener('keydown', this.handleKeyDown.bind(this));\r\n  }\r\n\r\n  updateFocusableElements() {\r\n    const focusableSelectors = 'a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]),[tabindex]:not([tabindex=\"-1\"])';\r\n    const lightDOMFocusableEls = Array.from(this.el.querySelectorAll(focusableSelectors));\r\n    const shadowDOMFocusableEls = Array.from(this.el.shadowRoot.querySelectorAll(focusableSelectors));\r\n\r\n    this.allFocusableEls = [...lightDOMFocusableEls, ...shadowDOMFocusableEls] as HTMLElement[];\r\n    this.firstFocusableEl = this.allFocusableEls[0];\r\n    this.lastFocusableEl = this.allFocusableEls[this.allFocusableEls.length - 1];\r\n  }\r\n\r\n  handleKeyDown(e: KeyboardEvent) {\r\n    if (e.key === 'Escape') {\r\n      this.toggleClose();\r\n    } else if (!this.isDialogVisible || e.key !== 'Tab') return;\r\n\r\n    const activeElement = document.activeElement.shadowRoot ? document.activeElement.shadowRoot.activeElement : document.activeElement;\r\n\r\n    const lastElementIndex = this.allFocusableEls.indexOf(this.lastFocusableEl);\r\n    const firstElementIndex = this.allFocusableEls.indexOf(this.firstFocusableEl);\r\n\r\n    if (e.shiftKey) {\r\n      if (activeElement === this.firstFocusableEl) {\r\n        this.allFocusableEls[lastElementIndex].focus();\r\n        e.preventDefault();\r\n      }\r\n    } else {\r\n      if (activeElement === this.lastFocusableEl) {\r\n        this.allFocusableEls[firstElementIndex].focus();\r\n        e.preventDefault();\r\n      }\r\n    }\r\n  }\r\n\r\n  handleBackdropClick() {\r\n    if (!this.isAlertDialog) this.toggleClose();\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.updateFocusableElements();\r\n    this.el.addEventListener('keydown', this.handleKeyDown.bind(this));\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div onClick={this.handleBackdropClick.bind(this)} data-state={this.isDialogVisible ? 'visible' : 'hidden'} class={'backdrop'}></div>\r\n        <div\r\n          role=\"dialog\"\r\n          aria-labelledby=\"dialogTitle\"\r\n          aria-describedby=\"dialogDescription\"\r\n          tabIndex={-1}\r\n          aria-label={this.dialogTitle}\r\n          data-state={this.isDialogVisible ? 'visible' : 'hidden'}\r\n          class={'dialog'}\r\n        >\r\n          {this.isDialogVisible && (\r\n            <Fragment>\r\n              <h2 class=\"dialog-title\" id=\"dialogTitle\">\r\n                {this.dialogTitle}\r\n              </h2>\r\n              <div id=\"dialogDescription\">\r\n                <slot name=\"dialog-body\"></slot>\r\n              </div>\r\n              <slot name=\"dialog-footer\"></slot>\r\n              {!this.isAlertDialog && (\r\n                <button aria-label=\"Close\" onClick={this.toggleClose.bind(this)} class={'IconButton'}>\r\n                  <svg width=\"15\" height=\"15\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path\r\n                      d=\"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z\"\r\n                      fill=\"currentColor\"\r\n                      fill-rule=\"evenodd\"\r\n                      clip-rule=\"evenodd\"\r\n                    ></path>\r\n                  </svg>\r\n                </button>\r\n              )}\r\n            </Fragment>\r\n          )}\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}